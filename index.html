<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, viewport-fit=cover" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="x-ua-compatible" content="IE=edge" />
    <title>首页</title>

    <script src="./js/three.min.js"></script>
    <script src="./js/browser.js"></script>

    <link rel="stylesheet" href="./css/photo-sphere-viewer.css" />
    <script src="./js/photo-sphere-viewer.js"></script>

    <link rel="stylesheet" href="./css/markers.css" />
    <script src="./js/markers.js"></script>

    <!-- <script src="./js/gyroscope.js"></script> -->

    <script src="./js/visible-range.js"></script>

    <script src="./js/jweixin-1.3.2.js"></script>

</head>

<body>
    <div id="viewer"></div>
    <style>
        body {
            margin: 0;
        }

        /* the viewer container must have a defined size */
        #viewer {
            width: 100vw;
            height: 100vh;
        }
    </style>
    <script>
        viewer = new PhotoSphereViewer.Viewer({
            loadingImg: './imgs/photosphere-logo.gif',
            container: 'viewer',
            // 对于立方体贴图
            // threejs demo
            // panorama: {
            //     left: './imgs/demo1/posx.jpg',
            // front: './imgs/demo1/negz.jpg',
            // right: './imgs/demo1/negx.jpg',
            // back: './imgs/demo1/posz.jpg',
            // top: './imgs/demo1/posy.jpg',
            // bottom: './imgs/demo1/negy.jpg',
            // },
            // 华为网页图
            panorama: {
                left: './imgs/demo2/pano_l.jpg',
                front: './imgs/demo2/pano_f.jpg',
                right: './imgs/demo2/pano_r.jpg',
                back: './imgs/demo2/pano_b.jpg',
                top: './imgs/demo2/pano_u.jpg',
                bottom: './imgs/demo2/pano_d.jpg',
            },
            // // 全景图贴图
            // panorama: './imgs/timg.jpg',
            // // 裁剪全景图
            // panoData: {
            //     fullWidth: 2400,
            //     fullHeight: 1200,
            //     croppedWidth: 1920,
            //     croppedHeight: 1200,
            //     croppedX: 240,
            //     croppedY: 0
            // },
            // 默认缩放级别
            defaultZoomLvl: 0,
            defaultLong: 0, //初始经度，介于0和2π之间
            defaultLat: 0, //初始纬度，介于-π/ 2和π/ 2之间。
            // 不显示工具条
            navbar: false,
            // navbar: [],
            //全景图自动开始旋转之前的空闲时间（毫秒）
            autorotateDelay: true,
            //旋转速度
            autorotateSpeed: '1rpm',
            // 标记位
            plugins: [
                [PhotoSphereViewer.MarkersPlugin],
                [PhotoSphereViewer.GyroscopePlugin],
                [PhotoSphereViewer.VisibleRangePlugin]
            ],
        });

        // 标记
        const markersPlugin = viewer.getPlugin(PhotoSphereViewer.MarkersPlugin);
        // 点击标记事件
        markersPlugin.on('select-marker', (e, marker) => {
            console.log(marker);
            // 更新标记
            // markersPlugin.updateMarker({
            //     id: marker.id,
            //     image: './imgs/pin-blue.png'
            // });
            // 跳转微信
            wx.miniProgram.navigateTo({
                url: "../logs/logs?from=" + marker.data
            })
        });
        // 增加一些标记
        viewer.once('ready', randomPoints);

        function randomPoints() {
            const points = [];
            // for (let i = 0, l = Math.random() * 2 + 4; i < l; i++) {
            //     points.push({
            //         position: {
            //             longitude: (i + Math.random()) * 2 *
            //                 Math.PI / l,
            //             latitude: Math.random() * Math.PI / 3 - Math.PI / 6,
            //         },
            //         pause: i % 3 === 0 ? 2000 : 0,
            //         tooltip: 'Test tooltip',
            //     });
            // }
            let markers = [

                {
                    id: '#government',
                    latitude: 0.5,
                    longitude: 0,
                    image: './imgs/buttons/government.png',
                    width: 100,
                    height: 50,
                    anchor: 'bottom center',
                    data: "government"
                },
                {
                    id: '#education',
                    latitude: 0.1,
                    longitude: 0.2,
                    image: './imgs/buttons/education.png',
                    width: 100,
                    height: 50,
                    anchor: 'bottom center',
                    data: "education"
                },
                {
                    id: '#hicampus',
                    latitude: 0.1,
                    longitude: 1.8,
                    image: './imgs/buttons/hicampus.png',
                    width: 100,
                    height: 50,
                    anchor: 'bottom center',
                    data: "hicampus"
                },
                {
                    id: '#safe',
                    latitude: 0,
                    longitude: 1,
                    image: './imgs/buttons/safe.png',
                    width: 100,
                    height: 50,
                    anchor: 'bottom center',
                    data: "safe"
                },
            ]
            markersPlugin.setMarkers(markers);
            // points.map((pt, i) => ({
            // id: '#' + i,
            // latitude: pt.position.latitude,
            // longitude: pt.position.longitude,
            // // x: pt.position.x,
            // // y: pt.position.y,
            // image: './imgs/government.png',
            // width: 100,
            // height: 32,
            // anchor: 'bottom center',
            // data: "marker:下标" + i
            // }))
        }
    </script>
</body>

</html>